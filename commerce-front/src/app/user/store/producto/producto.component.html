<div class="app-container">
    <app-header></app-header>

    <main class="flex-grow-1">

        <div class="container mt-5">
            <div class="card shadow-lg border-0 rounded-4">

                <div class="card-header text-center text-white rounded-top-4" style="background: linear-gradient(135deg,#6a11cb,#2575fc);">
                    <h3 class="mb-0">🛒 Mis Productos</h3>
                </div>

                <div class="card-body p-4">
                    <!-- Botón Crear Producto -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <button class="btn btn-gradient" (click)="crearProductos()">
                            <i class="fas fa-plus me-2"></i> Crear Producto
                        </button>
                    </div>
                    <!-- Filtros -->
                    <div class="text-center mb-4">
                        <button class="btn btn-gradient me-2" (click)="filtrarProductos('todos')">Todos</button>
                        <button class="btn btn-outline-success me-2" (click)="filtrarProductos('aprobados')">Aprobados</button>
                        <button class="btn btn-outline-warning me-2" (click)="filtrarProductos('pendientes')">Pendientes</button>
                        <button class="btn btn-outline-danger" (click)="filtrarProductos('rechazados')">Rechazados</button>
                    </div>


                    <!-- Tabla -->
                    <div *ngIf="cargando" class="text-center text-muted mt-3">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-2">Cargando productos...</p>
                    </div>

                    <div *ngIf="!cargando && productos.length === 0" class="text-center text-muted mt-3">
                        <i class="fas fa-box-open fa-3x text-secondary mb-2"></i>
                        <p>No tienes productos en esta categoría</p>
                    </div>

                    <div class="table-responsive" *ngIf="productos.length > 0">
                        <table class="table table-hover align-middle text-center">
                            <thead class="text-white" style="background: linear-gradient(135deg,#6a11cb,#2575fc);">
                            <tr>
                                <th>ID</th>
                                <th>Imagen</th>
                                <th>Nombre</th>
                                <th>Categoría</th>
                                <th>Precio</th>
                                <th>Revisión</th>
                                <th>Acciones</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr *ngFor="let producto of productosFiltrados" class="fila-producto">
                                <td>{{ producto.idProducto }}</td>
                                <td>
                                <img
                                    [src]="producto.imagenUrl || 'assets/img/placeholder.png'"
                                    alt="Imagen del producto"
                                    class="img-thumbnail rounded-3"
                                    width="70"
                                    height="70"
                                    style="object-fit: cover;"
                                />
                                </td>
                                <td>{{ producto.nombre }}</td>
                                <td>{{ producto.categoriaNombre }}</td>
                                <td>{{ producto.precio | currency:'Q' }}</td>
                                <td>
                                <span
                                    [ngClass]="{
                                    'badge bg-secondary': producto.estadoRevision === 'PENDIENTE',
                                    'badge bg-success': producto.estadoRevision === 'APROBADO',
                                    'badge bg-danger': producto.estadoRevision === 'RECHAZADO'
                                    }"
                                    class="px-3 py-2 rounded-pill fw-bold"
                                >
                                    {{ producto.estadoRevision }}
                                </span>
                                </td>
                                <td>
                                <button class="btn btn-outline-primary btn-sm me-2" (click)="verDetalles(producto)">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-success btn-sm me-2" (click)="editar()">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger btn-sm" (click)="eliminar()">
                                    <i class="fas fa-trash"></i>
                                </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>

        <!-- Modal de Detalles -->
        <div class="modal fade" id="detalleModal" tabindex="-1" aria-labelledby="detalleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content detalle-modal shadow-lg border-0 rounded-4">
                
                    <div class="modal-header text-white rounded-top-4" 
                        style="background: linear-gradient(135deg, #6a11cb, #2575fc);">
                        <h5 class="modal-title fw-bold" id="detalleModalLabel">
                        {{ productoSeleccionado?.nombre }}
                        </h5>
                        <button type="button" class="btn-close btn-close-white" 
                                data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>

                    <div class="modal-body p-4" *ngIf="productoSeleccionado">
                        <div class="row align-items-center">
                        
                        <!-- Imagen del producto -->
                        <div class="col-md-5 text-center mb-3 mb-md-0">
                            <img
                            [src]="productoSeleccionado.imagenUrl || 'assets/img/placeholder.png'"
                            alt="Imagen del producto"
                            class="img-fluid rounded-4 shadow-sm border"
                            style="max-height: 300px; object-fit: cover;"
                            />
                        </div>

                        <!-- Detalles del producto -->
                        <div class="col-md-7">
                            <ul class="list-group list-group-flush rounded-4 shadow-sm">
                            <li class="list-group-item">
                                <strong>Descripción:</strong>
                                <span class="text-muted">{{ productoSeleccionado.descripcion }}</span>
                            </li>
                            <li class="list-group-item">
                                <strong>Precio:</strong>
                                <span class="fw-bold text-success">
                                {{ productoSeleccionado.precio | currency:'Q' }}
                                </span>
                            </li>
                            <li class="list-group-item">
                                <strong>Stock:</strong> {{ productoSeleccionado.stock }}
                            </li>
                            <li class="list-group-item">
                                <strong>Estado:</strong>
                                <span class="badge bg-gradient">
                                {{ productoSeleccionado.estadoProducto }}
                                </span>
                            </li>
                            <li class="list-group-item">
                                <strong>Categoría:</strong> {{ productoSeleccionado.categoriaNombre }}
                            </li>
                            <li class="list-group-item">
                                <strong>Fecha de publicación:</strong> 
                                {{ productoSeleccionado.fechaPublicacion | date:'short' }}
                            </li>
                            </ul>
                        </div>
                        </div>
                    </div>

                    <div class="modal-footer d-flex justify-content-between">
                            <td>
                            <button class="btn btn-outline-success btn-sm me-2" (click)="editar()">
                            <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm" (click)="eliminar()">
                            <i class="fas fa-trash"></i>
                            </button>
                            </td>
                    </div>

                </div>
            </div>
        </div>

    </main>

    <app-footer></app-footer>
</div>
