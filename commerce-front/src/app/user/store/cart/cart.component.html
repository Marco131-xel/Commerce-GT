<div class="app-container">
  <app-header></app-header>

  <main class="container my-5">
    <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
      <div
        class="card-header text-center text-white fw-bold fs-4 py-3"
        style="background: linear-gradient(135deg, #6a11cb, #2575fc);"
      >
        ðŸ›’ Mis Carritos de Compras
      </div>

      <div class="card-body p-4">
        <ng-container *ngIf="carritos && carritos.length > 0; else vacio">
          <div class="accordion" id="carritoAccordion">
            <div class="accordion-item mb-3" *ngFor="let carrito of carritos; let i = index">
              <h2 class="accordion-header" id="heading{{ i }}">
                <button
                  class="accordion-button fw-bold"
                  type="button"
                  data-bs-toggle="collapse"
                  [attr.data-bs-target]="'#collapse' + i"
                  [attr.aria-expanded]="i === 0"
                >
                  ðŸ›’ {{ carrito.nombre || ('Carrito ' + (i + 1)) }}
                </button>
              </h2>
              <div
                [id]="'collapse' + i"
                class="accordion-collapse collapse"
                [class.show]="i === 0"
                data-bs-parent="#carritoAccordion"
              >
                <div class="accordion-body">
                  <div class="table-responsive">
                    <table class="table align-middle text-center">
                      <thead class="table-info">
                        <tr>
                          <th>Producto</th>
                          <th>Precio</th>
                          <th>Cantidad</th>
                          <th>Subtotal</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let item of carrito.detalles">
                          <td class="text-start">
                            <div class="d-flex align-items-center">
                              <img
                                [src]="item.producto?.imagenUrl || 'https://via.placeholder.com/80x80?text=Producto'"
                                class="img-thumbnail rounded-3 me-3 shadow-sm"
                                style="width: 80px; height: 80px; object-fit: cover;"
                              />
                              <div>
                                <strong>{{ item.producto?.nombre || 'Producto sin nombre' }}</strong>
                              </div>
                            </div>
                          </td>
                          <td>
                            <span class="fw-bold text-success">
                              Q{{ item.producto?.precio | number: '1.2-2' }}
                            </span>
                          </td>
                          <td>{{ item.cantidad }}</td>
                          <td>
                            <span class="fw-bold text-primary">
                              Q{{ item.cantidad * (item.producto?.precio || 0) | number: '1.2-2' }}
                            </span>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <div class="d-flex justify-content-between align-items-center mt-3 border-top pt-3">
                    <button class="btn btn-gradient" (click)="procederPago(carrito)">
                      <i class="fas fa-credit-card me-1"></i> Proceder al Pago
                    </button>
                    <button class="btn btn-outline-danger btn-sm" (click)="eliminar(carrito)">
                      <i class="fas fa-trash"></i>
                    </button>
                    <h5 class="mb-0">
                      Total: <span class="text-success fw-bold">
                        Q{{ calcularTotal(carrito) | number: '1.2-2' }}
                      </span>
                    </h5>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>

        <ng-template #vacio>
          <div class="text-center mt-5">
            <i class="fas fa-shopping-cart fa-5x text-secondary mb-3"></i>
            <h4 class="fw-bold text-muted mb-3">No tienes carritos activos</h4>
            <p class="text-muted mb-4">Explora nuestros productos y crea uno nuevo.</p>
            <button class="btn btn-gradient" (click)="comprar()">
              ðŸ›’ Comprar
            </button>
          </div>
        </ng-template>
      </div>
    </div>
  </main>

  <app-footer></app-footer>
</div>
